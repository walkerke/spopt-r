<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Flow Refueling Location Model (FRLM) — frlm • spopt</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Flow Refueling Location Model (FRLM) — frlm"><meta name="description" content="Solves the Flow Refueling Location Model to optimally place refueling
facilities along network paths. This model maximizes the volume of
origin-destination flows that can be served given vehicle range constraints."><meta property="og:description" content="Solves the Flow Refueling Location Model to optimally place refueling
facilities along network paths. This model maximizes the volume of
origin-destination flows that can be served given vehicle range constraints."><meta property="og:image" content="https://walker-data.com/spopt/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-#1e3a5f" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">spopt</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/getting-started.html">Getting Started</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/regionalization.html">Regionalization</a></li>
    <li><a class="dropdown-item" href="../articles/facility-location.html">Facility Location</a></li>
    <li><a class="dropdown-item" href="../articles/huff-model.html">Huff Model</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/travel-time-matrices.html">Travel-Time Cost Matrices</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/kylewalker/spopt-r/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Flow Refueling Location Model (FRLM)</h1>
      <small class="dont-index">Source: <a href="https://github.com/kylewalker/spopt-r/blob/HEAD/R/locate_frlm.R" class="external-link"><code>R/locate_frlm.R</code></a></small>
      <div class="d-none name"><code>frlm.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Solves the Flow Refueling Location Model to optimally place refueling
facilities along network paths. This model maximizes the volume of
origin-destination flows that can be served given vehicle range constraints.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">frlm</span><span class="op">(</span></span>
<span>  <span class="va">flows</span>,</span>
<span>  <span class="va">candidates</span>,</span>
<span>  network <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">vehicle_range</span>,</span>
<span>  <span class="va">n_facilities</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"greedy"</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-flows">flows<a class="anchor" aria-label="anchor" href="#arg-flows"></a></dt>
<dd><p>A data frame or sf object containing flow information with columns:</p><ul><li><p><code>origin</code>: Origin identifier</p></li>
<li><p><code>destination</code>: Destination identifier</p></li>
<li><p><code>volume</code>: Flow volume (e.g., number of trips)</p></li>
</ul></dd>


<dt id="arg-candidates">candidates<a class="anchor" aria-label="anchor" href="#arg-candidates"></a></dt>
<dd><p>An sf object with candidate facility locations (points).</p></dd>


<dt id="arg-network">network<a class="anchor" aria-label="anchor" href="#arg-network"></a></dt>
<dd><p>Optional. A distance matrix between candidates. If NULL
(default), Euclidean distances are computed from candidate geometries.
For network distances, compute externally using packages like r5r or
dodgr and pass the resulting matrix here.</p></dd>


<dt id="arg-vehicle-range">vehicle_range<a class="anchor" aria-label="anchor" href="#arg-vehicle-range"></a></dt>
<dd><p>Numeric. Maximum vehicle range (same units as network distances).</p></dd>


<dt id="arg-n-facilities">n_facilities<a class="anchor" aria-label="anchor" href="#arg-n-facilities"></a></dt>
<dd><p>Integer. Number of facilities to place.</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>Character. Optimization method: "greedy" (default and currently only option).</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical. Print progress messages.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list with class "spopt_frlm" containing:</p><ul><li><p><code>facilities</code>: The candidates sf object with a <code>.selected</code> column</p></li>
<li><p><code>selected_indices</code>: 1-based indices of selected facilities</p></li>
<li><p><code>coverage</code>: Coverage statistics</p></li>
</ul><p>Metadata is stored in the "spopt" attribute.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The Flow Refueling Location Model (Kuby &amp; Lim, 2005) addresses the problem
of locating refueling stations for range-limited vehicles (e.g., electric
vehicles, hydrogen fuel cell vehicles) along travel paths.</p>
<p>A flow (origin-destination path) is "covered" if a vehicle can complete
the <strong>round trip</strong> with refueling stops at the selected facilities. The model
assumes:</p><ul><li><p>Vehicles start at the origin with <strong>half a tank</strong> (can travel R/2)</p></li>
<li><p>At each open station, vehicles refuel to full (can travel R)</p></li>
<li><p>The round trip must be completable without running out of fuel</p></li>
</ul><p>For a flow to be covered, three conditions must be met:</p><ol><li><p>First open station must be within R/2 from origin (half-tank start)</p></li>
<li><p>Each subsequent open station must be within R of the previous</p></li>
<li><p>Last open station must be within R/2 of destination (to allow return)</p></li>
</ol><p>This implementation uses a greedy heuristic that iteratively selects the
facility providing the greatest marginal increase in covered flow volume.</p>
    </div>
    <div class="section level2">
    <h2 id="input-format">Input Format<a class="anchor" aria-label="anchor" href="#input-format"></a></h2>


<p>For simple cases, you can provide:</p><ul><li><p><code>flows</code>: Data frame with origin, destination, volume</p></li>
<li><p><code>candidates</code>: sf points for potential facility locations</p></li>
<li><p><code>network</code>: Pre-computed distance matrix (optional)</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Kuby, M., &amp; Lim, S. (2005). The flow-refueling location problem for
alternative-fuel vehicles. Socio-Economic Planning Sciences, 39(2), 125-145.
<a href="https://doi.org/10.1016/j.seps.2004.03.001" class="external-link">doi:10.1016/j.seps.2004.03.001</a></p>
<p>Capar, I., &amp; Kuby, M. (2012). An efficient formulation of the flow refueling
location model for alternative-fuel stations. IIE Transactions, 44(8), 622-636.
<a href="https://doi.org/10.1080/0740817X.2011.635175" class="external-link">doi:10.1080/0740817X.2011.635175</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Simple example with distance matrix</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create candidate locations</span></span></span>
<span class="r-in"><span><span class="va">candidates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,</span></span>
<span class="r-in"><span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create flows (using candidate indices as origins/destinations)</span></span></span>
<span class="r-in"><span><span class="va">flows</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  origin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  destination <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">10</span>, <span class="fl">7</span>, <span class="fl">9</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  volume <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">200</span>, <span class="fl">150</span>, <span class="fl">300</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Solve with vehicle range of 50 units</span></span></span>
<span class="r-in"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">frlm</span><span class="op">(</span><span class="va">flows</span>, <span class="va">candidates</span>, vehicle_range <span class="op">=</span> <span class="fl">50</span>, n_facilities <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># View selected facilities</span></span></span>
<span class="r-in"><span><span class="va">result</span><span class="op">$</span><span class="va">facilities</span><span class="op">[</span><span class="va">result</span><span class="op">$</span><span class="va">facilities</span><span class="op">$</span><span class="va">.selected</span>, <span class="op">]</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kyle Walker.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.9000.</p>
</div>

    </footer></div>





  </body></html>


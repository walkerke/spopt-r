<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Getting started with spopt • spopt</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="getting-started_files/libs/quarto-html/popper.min.js"></script><script src="getting-started_files/libs/quarto-html/tippy.umd.min.js"></script><link href="getting-started_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="getting-started_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Getting started with spopt">
<meta property="og:image" content="https://walker-data.com/spopt/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-#1e3a5f" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">spopt</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/getting-started.html">Getting Started</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/regionalization.html">Regionalization</a></li>
    <li><a class="dropdown-item" href="../articles/facility-location.html">Facility Location</a></li>
    <li><a class="dropdown-item" href="../articles/huff-model.html">Huff Model</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/travel-time-matrices.html">Travel-Time Cost Matrices</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/kylewalker/spopt-r/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Getting started with spopt</h1>




      <small class="dont-index">Source: <a href="https://github.com/kylewalker/spopt-r/blob/HEAD/vignettes/getting-started.qmd" class="external-link"><code>vignettes/getting-started.qmd</code></a></small>
      <div class="d-none name"><code></code></div>
    </div>






    <p>spopt provides R-native implementations of spatial optimization algorithms for regionalization, facility location, and market analysis. The package is inspired by Python’s PySAL spopt library, my all-time favorite Python package. Its aim is to bring spopt’s powerful algorithms to R users with an sf-first API and a Rust backend for performance.</p>
<section class="level3"><h3 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h3>
<p>The easiest way to install spopt is from my r-universe repository, which provides pre-built binaries:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"spopt"</span>, repos <span class="op">=</span> <span class="st">"https://walkerke.r-universe.dev"</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Once installed, load the package along with sf for spatial data handling and tidyverse for data manipulation:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/kylewalker/spopt-r" class="external-link">spopt</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span></code></pre></div>
</div>
</section><section class="level3"><h3 id="what-can-spopt-do">What can spopt do?<a class="anchor" aria-label="anchor" href="#what-can-spopt-do"></a>
</h3>
<p>spopt includes three families of spatial optimization algorithms:</p>
<p><strong>Regionalization</strong>: Build spatially-contiguous regions from smaller geographies. This is useful when you need to aggregate Census blocks into larger areas, create balanced sales territories, or design compact political districts. Algorithms include SKATER, AZP, Max-P, SPENC, and spatially-constrained Ward clustering.</p>
<p><strong>Facility location</strong>: Find optimal locations for facilities given demand points and candidate sites. Whether you’re siting fire stations to minimize response times, placing retail stores to maximize coverage, or locating EV charging stations along highway corridors, spopt has algorithms for these problems. Options include P-Median, P-Center, MCLP, LSCP, CFLP, P-Dispersion, and FRLM.</p>
<p><strong>Market analysis</strong>: Model consumer behavior and market competition with the Huff model. This classic retail gravity model predicts market share and expected sales based on store attractiveness and distance to consumers.</p>
</section><section class="level3"><h3 id="a-quick-example">A quick example<a class="anchor" aria-label="anchor" href="#a-quick-example"></a>
</h3>
<p>Let’s run a quick facility location analysis to see spopt in action. We’ll find optimal locations for 5 facilities to serve Census tracts in Tarrant County, Texas (home of Fort Worth).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://walker-data.com/tidycensus/" class="external-link">tidycensus</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get population data for Tarrant County tracts</span></span>
<span><span class="va">tarrant</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://walker-data.com/tidycensus/reference/get_acs.html" class="external-link">get_acs</a></span><span class="op">(</span></span>
<span>  geography <span class="op">=</span> <span class="st">"tract"</span>,</span>
<span>  variables <span class="op">=</span> <span class="st">"B01003_001"</span>,</span>
<span>  state <span class="op">=</span> <span class="st">"TX"</span>,</span>
<span>  county <span class="op">=</span> <span class="st">"Tarrant"</span>,</span>
<span>  geometry <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  year <span class="op">=</span> <span class="fl">2023</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use tract centroids as both demand points and candidate facility sites</span></span>
<span><span class="va">tarrant_pts</span> <span class="op">&lt;-</span> <span class="va">tarrant</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_centroid</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Solve the P-Median problem: minimize total weighted distance</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/p_median.html">p_median</a></span><span class="op">(</span></span>
<span>  demand <span class="op">=</span> <span class="va">tarrant_pts</span>,</span>
<span>  facilities <span class="op">=</span> <span class="va">tarrant_pts</span>,</span>
<span>  n_facilities <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  weight_col <span class="op">=</span> <span class="st">"estimate"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View selected facility locations</span></span>
<span><span class="va">result</span><span class="op">$</span><span class="va">facilities</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.selected</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 5 features and 7 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: -97.40206 ymin: 32.66538 xmax: -97.12351 ymax: 32.89751
Geodetic CRS:  NAD83
        GEOID                                        NAME   variable estimate
1 48439111516 Census Tract 1115.16; Tarrant County; Texas B01003_001     7137
2 48439113637 Census Tract 1136.37; Tarrant County; Texas B01003_001     4732
3 48439110402 Census Tract 1104.02; Tarrant County; Texas B01003_001     5387
4 48439105800    Census Tract 1058; Tarrant County; Texas B01003_001     4430
5 48439113946 Census Tract 1139.46; Tarrant County; Texas B01003_001     6509
   moe                   geometry .selected .n_assigned
1 1007 POINT (-97.12453 32.66618)      TRUE         112
2  703 POINT (-97.12351 32.84844)      TRUE          90
3   16 POINT (-97.40206 32.80275)      TRUE          69
4  698 POINT (-97.34284 32.66538)      TRUE         107
5 3880 POINT (-97.28117 32.89751)      TRUE          71</code></pre>
</div>
</div>
<p>The <code><a href="../reference/p_median.html">p_median()</a></code> function returns a list with allocated demand points and selected facilities. Each demand point is assigned to its nearest selected facility, and the solution minimizes the total population-weighted distance.</p>
</section><section class="level3"><h3 id="sf-first-design">SF-first design<a class="anchor" aria-label="anchor" href="#sf-first-design"></a>
</h3>
<p>All spopt functions accept and return sf objects. This means you can:</p>
<ul>
<li>Pass sf polygons or points directly to functions</li>
<li>Use any coordinate reference system (functions handle transformations internally)</li>
<li>Pipe results directly into visualization with ggplot2, mapview, or mapgl</li>
<li>Integrate seamlessly with tidycensus, tigris, and other spatial R packages</li>
</ul></section><section class="level3"><h3 id="next-steps">Next steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h3>
<ul>
<li>
<a href="regionalization.html">Regionalization</a> - Build spatially-contiguous regions with SKATER, AZP, Max-P, and more</li>
<li>
<a href="facility-location.html">Facility Location</a> - Solve location-allocation problems with P-Median, MCLP, and other algorithms</li>
<li>
<a href="huff-model.html">Huff Model</a> - Model market share and retail competition</li>
<li>
<a href="travel-time-matrices.html">Travel-Time Cost Matrices</a> - Use real-world travel times with r5r and other routing engines</li>
</ul></section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kyle Walker.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
